<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" href="logo.png" type="image/png">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daily Goals</title>
<style>
  body { font-family: Arial,sans-serif; background:linear-gradient(135deg,#6dd5ed,#2193b0); color:#fff; margin:0; padding:20px; }
  .container { max-width:900px; margin:auto; padding:20px; background:rgba(0,0,0,0.6); border-radius:20px; }
  h1 { text-align:center; margin-bottom:30px; }
  .row { display:flex; gap:20px; flex-wrap:wrap; margin-bottom:15px; }
  .card { flex:1; padding:15px; background:rgba(255,255,255,0.1); border-radius:15px; }
  .card h3 { margin-top:0; }
  label { display:block; margin:6px 0 4px; }
  input, select, textarea { width:100%; padding:8px; border:none; border-radius:8px; margin-bottom:10px; }
  button { padding:10px 20px; border:none; border-radius:12px; background:#ffb400; color:#000; font-size:16px; cursor:pointer; transition:0.3s; }
  button:hover { background:#ffc933; }
  .result { margin-top:20px; padding:15px; background:rgba(255,255,255,0.15); border-radius:12px; }
  #coinPopup { position: fixed; top:20%; left:50%; transform:translateX(-50%); background:#22c55e; color:white; font-size:2rem; font-weight:bold; padding:12px 25px; border-radius:12px; opacity:0; pointer-events:none; transition: opacity 0.5s, transform 0.5s; z-index:1000; }
</style>
</head>
<body>

<button onclick="window.location.href='index.html'" 
  style="position: fixed; z-index: 2000; top: 20px; left: 20px; padding: 12px 20px; border: none; border-radius: 8px; background: linear-gradient(135deg, #ff5ac0, #ffea00); color: black; font-size: 16px; font-weight: bold; cursor: pointer;">üè† Home</button>
  <div id="topBar" style="
  position: fixed; 
  top: 0; left: 0; right: 0; 
  height: 50px; 
  background: rgba(0,0,0,0.7); 
  color: white; 
  font-size: 18px; 
  display: flex; 
  justify-content: space-around; 
  align-items: center;
  z-index: 1001;
">
  <span>üí∞ Balance: <span id="balanceDisplay">0</span></span>
  <span>üî• Streak: <span id="streakDisplay">0</span></span>
</div>

<!-- Add some top padding to container so it‚Äôs not hidden under the bar -->
<div class="container" style="padding-top: 70px;">

<div class="container">
<h1>Daily Goals Logger</h1>

<div class="row">
  <div class="card">
    <h3>Date</h3>
    <input type="text" id="date" readonly>
  </div>
  <div class="card">
    <h3>Daily Goal Completion</h3>
    <select id="goal">
      <option value="yes">‚úÖ Yes</option>
      <option value="no">‚ùå No</option>
    </select>
  </div>
</div>

<div class="row">
  <div class="card">
    <h3>Resonance Module</h3>
    <label>Math</label><input type="number" id="resoM" min="0">
    <label>Physics</label><input type="number" id="resoP" min="0">
    <label>Chemistry</label><input type="number" id="resoC" min="0">
  </div>
  <div class="card">
    <h3>PW Module</h3>
    <label>Math</label><input type="number" id="pwM" min="0">
    <label>Physics</label><input type="number" id="pwP" min="0">
    <label>Chemistry</label><input type="number" id="pwC" min="0">
  </div>
</div>

<div class="row">
  <div class="card">
    <button id="extraBtn" style="margin-top:10px;">Add Extra Questions ‚ûï</button>
    <!-- Add hidden inputs for extra questions -->
    <input type="hidden" id="extraReso" value="0">
    <input type="hidden" id="extraPw" value="0">
  </div>
  <div class="card">
    <h3>Productivity</h3>
    <textarea id="productivity" placeholder="Enter task like 'matrices oneshot done'..."></textarea>
  </div>
</div>

<button id="saveEntry">Save Entry</button>

<div class="result" id="result"></div>
</div>

<div id="coinPopup">+0 coins</div>
<audio id="coinSound" src="coin.mp3" preload="auto"></audio>


<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
  import { getDatabase, ref, update, onValue } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js";
  
  const firebaseConfig = {
    apiKey: "AIzaSyBKQJki3JUr5pDhgOxOQRmXpOY7-gOj2Bk",
    authDomain: "learnify-ada08.firebaseapp.com",
    databaseURL: "https://learnify-ada08-default-rtdb.firebaseio.com",
    projectId: "learnify-ada08",
    storageBucket: "learnify-ada08.appspot.com",
    messagingSenderId: "380617329082",
    appId: "1:380617329082:web:c2242ea09e6f78f1f73583",
    measurementId: "G-DT4WG6622N"
  };
  
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  
  const dateEl = document.getElementById("date");
  dateEl.value = new Date().toISOString().split("T")[0];
  
  const resultEl = document.getElementById("result");
  const coinPopup = document.getElementById("coinPopup");
  const coinSound = document.getElementById("coinSound");
  
  let storedCoins = 0;
  let storedTotalQ = 0;
  let streakShown = false;
  let streakChange = 0;
  // --- Live balance & streak updates
const userRef = ref(db, "users/aditya");
onValue(userRef, snapshot => {
    const val = snapshot.val() || {};
    document.getElementById("balanceDisplay").textContent = `Balance: ${val.balance || 0} üí∞`;
    document.getElementById("streakDisplay").textContent = `Streak: ${val.streak || 0} üî•`;
});

  // --- Show coin popup with optional streak
  function showCoinPopup(coins, showStreak = false) {
      coinPopup.textContent = (coins >= 0 ? `+${coins}` : `${coins}`) + " coins";
      coinPopup.style.background = coins >= 0 ? "#22c55e" : "#ef4444"; 
      coinPopup.style.opacity = "1";
      coinPopup.style.transform = "translateX(-50%) translateY(-20px)";
      coinSound.play();
  
      setTimeout(() => {
          coinPopup.style.opacity = "0";
          coinPopup.style.transform = "translateX(-50%) translateY(0)";
  
          if(showStreak && !streakShown && streakChange > 0){
              streakShown = true;
              coinPopup.textContent = "üî• Streak +1";
              coinPopup.style.background = "#facc15";
              coinPopup.style.opacity = "1";
              coinPopup.style.transform = "translateX(-50%) translateY(-20px)";
              setTimeout(()=>{
                  coinPopup.style.opacity = "0";
                  coinPopup.style.transform = "translateX(-50%) translateY(0)";
              },3000);
          }
      }, 3000);
  }
  
  // --- Extra Questions button (always works)
  document.getElementById("extraBtn").addEventListener("click", () => {
      let newExtraReso = parseInt(prompt("Enter extra Resonance questions:") || 0);
      let newExtraPw   = parseInt(prompt("Enter extra PW questions:") || 0);
  
      storedTotalQ += newExtraReso + newExtraPw;
  
      let extraCoins = 0;
      if(storedTotalQ <= 60) extraCoins = (newExtraReso + newExtraPw)*2;
      else extraCoins = (newExtraReso + newExtraPw)*3;
  
      storedCoins += extraCoins;
  
      // Update hidden inputs
      let extraResoInput = document.getElementById("extraReso");
      let extraPwInput = document.getElementById("extraPw");
      extraResoInput.value = (parseInt(extraResoInput.value)||0) + newExtraReso;
      extraPwInput.value = (parseInt(extraPwInput.value)||0) + newExtraPw;
  
      showCoinPopup(extraCoins); // no streak for extra
  
      resultEl.innerHTML += `
          <p><b>Extra Added:</b> Reso:${newExtraReso}, PW:${newExtraPw}</p>
          <p><b>New Total Questions:</b> ${storedTotalQ}</p>
          <h3>üéüÔ∏è Updated Coins: ${storedCoins}</h3>
      `;
  
      // Update Firebase balance for extra questions
      const userRef = ref(db,"users/aditya");
      onValue(userRef, snapshot=>{
          let val = snapshot.val()||{};
          let newBalance = (val.balance||0) + extraCoins;
          update(userRef,{balance:newBalance});
      },{onlyOnce:true});
  });
  


  
  // --- Save Entry
  document.getElementById("saveEntry").addEventListener("click", ()=>{
      let resoM = parseInt(document.getElementById("resoM").value)||0;
      let resoP = parseInt(document.getElementById("resoP").value)||0;
      let resoC = parseInt(document.getElementById("resoC").value)||0;
      let pwM   = parseInt(document.getElementById("pwM").value)||0;
      let pwP   = parseInt(document.getElementById("pwP").value)||0;
      let pwC   = parseInt(document.getElementById("pwC").value)||0;
      let extraReso = parseInt(document.getElementById("extraReso").value)||0;
      let extraPw   = parseInt(document.getElementById("extraPw").value)||0;
      let productivity = document.getElementById("productivity").value.toLowerCase();
      let goal = document.getElementById("goal").value;
  
      let totalQ = resoM+resoP+resoC+pwM+pwP+pwC+extraReso+extraPw;
  
      let coins = 0;
      if(totalQ <=60) coins += totalQ*2;
      else coins += 60*2 + (totalQ-60)*3;
  
      // Productivity coins
      if(productivity.includes("ipe")) coins+=20;
      else if(productivity.includes("oneshot")) coins+=50;
      else if(productivity.includes("test")) coins+=40;
      else if(productivity.includes("ncert")) coins+=30;
      else if(productivity.includes("revision")) coins+=30;
      else if(productivity.includes("reading")) coins+=10;
      else if(productivity.includes("concept")) coins+=25;
      else if(productivity.includes("formula sheet")) coins+=15;
  
      // Daily goal
      streakChange=0;
      if(goal==="yes") { coins+=10; streakChange=1; }
      else { coins-=10; streakChange=0; }
  
      storedCoins = coins;
      storedTotalQ = totalQ;
      streakShown = false; // allow streak popup
  
      // Update Firebase
      const userRef = ref(db,"users/aditya");
      onValue(userRef, snapshot=>{
          let val = snapshot.val()||{};
          let newBalance = (val.balance||0) + coins;
          let newStreak = val.streak||0;
          if(streakChange>0) newStreak+=1;
          update(userRef,{balance:newBalance, streak:newStreak});
      },{onlyOnce:true});
  
      // Display result
      resultEl.innerHTML = `
          <h3>Entry Saved ‚úÖ</h3>
          <p><b>Date:</b> ${dateEl.value}</p>
          <p><b>Resonance:</b> M:${resoM}, P:${resoP}, C:${resoC}</p>
          <p><b>PW:</b> M:${pwM}, P:${pwP}, C:${pwC}</p>
          <p><b>Total Questions:</b> ${totalQ}</p>
          <p><b>Productivity:</b> ${productivity}</p>
          <p><b>Daily Goal:</b> ${goal} (Streak ${streakChange>0?"+1":"No change"})</p>
          <h3>üéüÔ∏è Coins Earned Today: ${coins}</h3>
      `;
  
      showCoinPopup(coins, true);
      updateBalanceDisplay();
  });
  </script>
  
</body>
</html>