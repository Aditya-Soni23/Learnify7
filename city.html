<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" href="logo.png" type="image/png">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Virtual City</title>
  <style>
    :root{
      --ui-bg: rgba(0,0,0,.55);
      --ui-fg: #fff;
      --sky1: #bfe9ff; --sky2:#ffffff;
    }
    html,body{height:100%;margin:0}
    body{background: linear-gradient(180deg, var(--sky1), var(--sky2) 60%); font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; overflow:hidden}
    #hud{position:fixed; left:12px; top:12px; display:flex; gap:12px; align-items:center; z-index:10; flex-wrap:wrap}
    .card{background:var(--ui-bg); color:var(--ui-fg); border:1px solid rgba(255,255,255,.2); border-radius:14px; padding:10px 14px; backdrop-filter: blur(6px); box-shadow: 0 10px 30px rgba(0,0,0,.15)}
    #coinSlider{width:260px}
    .progress{height:8px; width:220px; border-radius:999px; background:rgba(255,255,255,.25); overflow:hidden; margin-top:6px}
    .progress > div{height:100%; width:0%; background:linear-gradient(90deg,#22d3ee,#818cf8)}
    canvas{display:block}
  </style>
</head>
<body>
    <button onclick="window.location.href='index.html'" 
    style="position: fixed;
           top: 20px;
           right: 50px;
           padding: 12px 20px;
           border: none;
           border-radius: 8px;
           background: linear-gradient(135deg, #ff5ac0, #ffea00);
           color: black;
           font-size: 16px;
           font-weight: bold;
           cursor: pointer;
           box-shadow: 0 4px 8px rgba(0,0,0,0.2);
           transition: all 0.3s ease;">
üè† Home
</button>
<div id="hud">
    <div class="card">ü™ô Coins: <span id="coinsOut">0</span></div>
    <!-- Optional: Streak display -->
    <div class="card">üî• Streak: <span id="streakOut">0</span></div>
  </div>
  

  <canvas id="city"></canvas>

  <script type="module">
    // ====== 2D Isometric City (No external libraries) ======
    const canvas = document.getElementById('city');
    const ctx = canvas.getContext('2d');
  
    function resize(){
      const dpr = Math.min(2, window.devicePixelRatio || 1);
      canvas.width = Math.floor(window.innerWidth * dpr);
      canvas.height = Math.floor(window.innerHeight * dpr);
      canvas.style.width = window.innerWidth + 'px';
      canvas.style.height = window.innerHeight + 'px';
      ctx.setTransform(dpr,0,0,dpr,0,0);
      draw();
    }
    window.addEventListener('resize', resize);
  
    const tileW = 64, tileH = 32;
    const gridRadius = 9;
    const roadEvery = 4;
  
    function origin(){
      return { x: canvas.clientWidth/2, y: Math.min(canvas.clientHeight*0.55, 420) };
    }
  
    function isoToScreen(i,j){
      const o = origin();
      const x = (i - j) * (tileW/2);
      const y = (i + j) * (tileH/2);
      return { x: o.x + x, y: o.y + y };
    }
  
    function shade(hex, pct){
      hex = hex.toString(16).padStart(6,'0');
      let r = parseInt(hex.slice(0,2),16), g = parseInt(hex.slice(2,4),16), b = parseInt(hex.slice(4,6),16);
      r = Math.min(255, Math.max(0, Math.round(r*(100+pct)/100)));
      g = Math.min(255, Math.max(0, Math.round(g*(100+pct)/100)));
      b = Math.min(255, Math.max(0, Math.round(b*(100+pct)/100)));
      return '#' + r.toString(16).padStart(2,'0') + g.toString(16).padStart(2,'0') + b.toString(16).padStart(2,'0');
    }
  
    function spiralCoords(n){
      const coords = [];
      let x=0,y=0,dx=0,dy=-1;
      const size = n*2+1;
      for(let k=0;k<size*size;k++){
        if (Math.abs(x) <= n && Math.abs(y) <= n) coords.push([x,y]);
        if (x===y || (x<0 && x===-y) || (x>0 && x===1-y)) [dx,dy] = [-dy, dx];
        x+=dx; y+=dy;
      }
      return coords;
    }
  
    function drawTileDiamond(x,y, color){
      ctx.beginPath();
      ctx.moveTo(x, y - tileH/2);
      ctx.lineTo(x + tileW/2, y);
      ctx.lineTo(x, y + tileH/2);
      ctx.lineTo(x - tileW/2, y);
      ctx.closePath();
      ctx.fillStyle = color;
      ctx.fill();
    }
  
    function drawBuilding(i,j,h, baseHex, glow=false){
      const p = isoToScreen(i,j);
      const topColor = shade(baseHex, 10);
      const leftColor = shade(baseHex, -25);
      const rightColor = shade(baseHex, -8);
  
      const x = p.x, y = p.y;
      const hx = tileW/2, hy = tileH/2;
  
      if(glow){ ctx.save(); ctx.shadowColor = "gold"; ctx.shadowBlur = 20; }
  
      // top
      ctx.beginPath();
      ctx.moveTo(x, y - hy - h);
      ctx.lineTo(x + hx, y - h);
      ctx.lineTo(x, y + hy - h);
      ctx.lineTo(x - hx, y - h);
      ctx.closePath();
      ctx.fillStyle = topColor;
      ctx.fill();
  
      // left
      ctx.beginPath();
      ctx.moveTo(x - hx, y - h);
      ctx.lineTo(x, y + hy - h);
      ctx.lineTo(x, y + hy);
      ctx.lineTo(x - hx, y);
      ctx.closePath();
      ctx.fillStyle = leftColor;
      ctx.fill();
  
      // right
      ctx.beginPath();
      ctx.moveTo(x + hx, y - h);
      ctx.lineTo(x, y + hy - h);
      ctx.lineTo(x, y + hy);
      ctx.lineTo(x + hx, y);
      ctx.closePath();
      ctx.fillStyle = rightColor;
      ctx.fill();
  
      if(glow) ctx.restore();
    }
  
    function drawTree(i,j, glow=false){
      const p = isoToScreen(i,j);
      if(glow){ ctx.save(); ctx.shadowColor="gold"; ctx.shadowBlur=15; }
      ctx.fillStyle = "#3c9a3c";
      ctx.beginPath();
      ctx.arc(p.x, p.y - tileH/2 - 10, 12, 0, Math.PI*2);
      ctx.fill();
      ctx.fillStyle = "#5a3d1e";
      ctx.fillRect(p.x-3, p.y - 10, 6, 12);
      if(glow) ctx.restore();
    }
  
    function drawVilla(i,j, glow=false){
      const p = isoToScreen(i,j);
      if(glow){ ctx.save(); ctx.shadowColor="gold"; ctx.shadowBlur=20; }
      ctx.fillStyle = "#fcd34d";
      ctx.beginPath();
      ctx.moveTo(p.x, p.y - tileH/2);
      ctx.lineTo(p.x + tileW/2, p.y);
      ctx.lineTo(p.x, p.y + tileH/2 - 8);
      ctx.lineTo(p.x - tileW/2, p.y);
      ctx.closePath();
      ctx.fill();
      ctx.fillStyle = "#b91c1c";
      ctx.beginPath();
      ctx.moveTo(p.x - tileW/2, p.y);
      ctx.lineTo(p.x, p.y - tileH/2 - 12);
      ctx.lineTo(p.x + tileW/2, p.y);
      ctx.closePath();
      ctx.fill();
      if(glow) ctx.restore();
    }
  
    function drawCar(i,j, glow=false){
      const p = isoToScreen(i,j);
      if(glow){ ctx.save(); ctx.shadowColor="gold"; ctx.shadowBlur=15; }
      ctx.fillStyle = "#ef4444";
      ctx.fillRect(p.x - 10, p.y - 8, 20, 12);
      ctx.fillStyle = "#000";
      ctx.beginPath();
      ctx.arc(p.x - 7, p.y + 4, 3, 0, Math.PI*2);
      ctx.arc(p.x + 7, p.y + 4, 3, 0, Math.PI*2);
      ctx.fill();
      if(glow) ctx.restore();
    }
  
    function drawSkyscraper(i,j,h, baseHex, glow=false){
      drawBuilding(i,j,h*1.8, baseHex, glow);
    }
  
    const plots = [];
    (function initPlots(){
      const coords = spiralCoords(gridRadius);
      let idx = 0;
      const types = ["building","tree","villa","car","building","skyscraper"];
      for (const [i,j] of coords){
        if (i % roadEvery === 0 || j % roadEvery === 0) continue;
        const threshold = idx + 1;
        const height = 20 + Math.random()*40;
        const palette = [0x9bb1c8,0xa5b4fc,0xfca5a5,0xfcd34d,0x86efac,0x93c5fd];
        const baseColor = palette[idx % palette.length];
        const type = types[idx % types.length];
        plots.push({i,j, threshold, height, baseColor, type});
        idx++;
      }
    })();
  
    let coins = 0;
    let buildsUnlocked = 0;
  
    const coinsOut = document.getElementById('coinsOut');
  
    function updateHUD(){
      coinsOut.textContent = coins.toString();
    }
  
    let hoverPlot = null;
  
    canvas.addEventListener("mousemove", (e) => {
      const rect = canvas.getBoundingClientRect();
      const mx = e.clientX - rect.left;
      const my = e.clientY - rect.top;
  
      hoverPlot = null;
      for (const p of plots){
        if(buildsUnlocked >= p.threshold){
          const scr = isoToScreen(p.i,p.j);
          if(Math.abs(mx - scr.x) < tileW/2 && Math.abs(my - scr.y) < tileH/2){
            hoverPlot = p;
            break;
          }
        }
      }
      draw();
    });
  
    function draw(){
      ctx.clearRect(0,0,canvas.clientWidth, canvas.clientHeight);
  
      const tiles = [];
      for(let i=-gridRadius;i<=gridRadius;i++){
        for(let j=-gridRadius;j<=gridRadius;j++){
          tiles.push({i,j});
        }
      }
      tiles.sort((a,b)=>(a.i+a.j)-(b.i+b.j));
  
      for(const t of tiles){
        const p = isoToScreen(t.i,t.j);
        const isRoad = (t.i % roadEvery === 0) || (t.j % roadEvery === 0);
        drawTileDiamond(p.x, p.y, isRoad ? '#4b5563' : '#a7e39a');
      }
  
      const unlocked = plots.filter(p=> buildsUnlocked >= p.threshold)
                            .sort((a,b)=> (a.i + a.j) - (b.i + b.j));
  
      for(const p of unlocked){
        const glow = hoverPlot === p;
        switch(p.type){
          case "tree": drawTree(p.i,p.j, glow); break;
          case "villa": drawVilla(p.i,p.j, glow); break;
          case "car": drawCar(p.i,p.j, glow); break;
          case "skyscraper": drawSkyscraper(p.i,p.j,p.height,p.baseColor, glow); break;
          default: drawBuilding(p.i,p.j,p.height,p.baseColor, glow);
        }
      }
    }
  
    window.setCityCoins = function(actualCoins){
      coins = actualCoins;                       // show real coins
      buildsUnlocked = Math.floor(coins / 5);    // 5 coins = 1 building unlocked
      updateHUD();
      draw();
    }
  
    // --- Firebase ---
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js";
  
    const firebaseConfig = {
      apiKey: "AIzaSyBKQJki3JUr5pDhgOxOQRmXpOY7-gOj2Bk",
      authDomain: "learnify-ada08.firebaseapp.com",
      databaseURL: "https://learnify-ada08-default-rtdb.firebaseio.com",
      projectId: "learnify-ada08",
      storageBucket: "learnify-ada08.appspot.com",
      messagingSenderId: "380617329082",
      appId: "1:380617329082:web:c2242ea09e6f78f1f73583",
      measurementId: "G-DT4WG6622N"
    };
  
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
  
    const balanceRef = ref(db, "users/aditya/balance");
    onValue(balanceRef, (snapshot)=>{
      if(snapshot.exists()){
        const balance = snapshot.val();
        window.setCityCoins(balance);
      }
    });
  
    resize();
    window.setCityCoins(0);
  </script>
  
</body>
</html>
